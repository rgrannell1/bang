
"use strict"





var servers = require('bang-test/tests/fuzz/server-config')
var commons = require('bang-test/commons/commons')
var engines = require('bang/data/engines.json')

var request = require('request')





describe('server suggestions resolve as expected', function ( ) {

	var state
	this.timeout(10000)

	before(done => {

		// -- deploy the server.

	})

	it('resolves and parses results from each suggestion server', done => {

		var testSuggestion = 'suggestion'

		commons.foldAsync(
			(results, engine, next) => {

				if (!engine.suggestTemplate) {
					next(results)
				}

				var path    = engine.patterns[0] + ' path'
				var url     = commons.bangUrl.suggest(8025, path)

				request(url, (err, res, body) => {

					next( results.concat({
						path,
						err,
						res,
						body: body ? body.toString( ) : null
					}) )

				})

			},
			engines,
			results => {

				console.log(results)
				done( )

			},
			[ ]
		)

	})

	after(done => {

		// -- shutdown server

	})

})
