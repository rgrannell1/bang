
"use strict"




var bangServer = require('bang/app/bang')
var engines    = require('bang/data/engines.json')
var fuzz       = require('bang-test/test-fuzz/fuzz')





var deploy = { }




var setupFuzzTest = (fuzzMethod, args, callback) => {

	var state = {errors: [ ]}

	if (args.server) {
		args.server.fatalErrorHandler = args.server.fatalErrorHandler.bind({ }, state.errors)
	}

	bangServer(args.server, (app, server) => {

		state.server = {app, server}

		fuzz[fuzzMethod](args.fuzz, args.engines, results => {

			state.results = results
			callback(state)

		})

	})

}




Object.keys(fuzz).forEach(method => {
	deploy[method] = setupFuzzTest.bind({ }, method)
})





module.exports = deploy
