
"use strict"





var constants  = require('bang-test/commons/constants')
var commons    = require('bang-test/commons/commons')




var fuzz = { }





fuzz.searchPattern = (config, pattern, callback) => {

	commons.foldAsync(
		(results, _, cReturn) => {

			commons.callServer(config.urlSource(pattern), result => {
				cReturn({
					pattern: results.pattern,
					results: results.results.concat(result)
				})
			})

		},

		new Array(config.testsPerPattern), callback, {pattern, results: [ ]}
	)

}

fuzz.searchEngine = (config, engine, callback) => {

	commons.foldAsync(
		(results, pattern, cReturn) => {

			fuzz.searchPattern(config, pattern, result => {
				cReturn({
					engine:  results.engine,
					results: results.results.concat(result)
				})
			})

		},

		engine.patterns, callback, {engine, results: [ ]}
	)

}

fuzz.searchEngines = (config, engines, callback) => {

	commons.foldAsync(
		(results, engine, cReturn) => {

			fuzz.searchEngine(config, engine, result => {
				cReturn(results.concat(result))
			})

		},

		engines, callback, [ ]
	)

}





module.exports = fuzz
