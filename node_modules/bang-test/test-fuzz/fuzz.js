
"use strict"





var constants  = require('bang-test/commons/constants')
var commons    = require('bang-test/commons/commons')




var fuzz = { }





fuzz.overPattern = (config, pattern, callback) => {

	commons.foldAsync(
		(results, _, cReturn) => {

			commons.callServer(config.randUrl(pattern), result => {
				cReturn(results.concat(result))
			})

		},

		new Array(config.testsPerPattern),
		results => {

			callback( results.map(result => {
				return {pattern, result}
			}) )

		}, [ ]
	)

}

fuzz.overEngine = (config, engine, callback) => {

	commons.foldAsync(
		(results, pattern, cReturn) => {

			fuzz.overPattern(config, pattern, result => {
				cReturn(results.concat(result))
			})

		},

		engine.patterns,
		results => {

			callback( results.map( ({pattern, result}) => {
				return {engine, pattern, result}
			}) )

		}, [ ]
	)

}

fuzz.overAllEngines = (config, engines, callback) => {

	commons.foldAsync(
		(results, engine, cReturn) => {

			fuzz.overEngine(config, engine, result => {
				cReturn(results.concat(result))
			})

		}, engines,callback, [ ]
	)

}





module.exports = fuzz
